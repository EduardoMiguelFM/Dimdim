# DimDim API - Sistema de Gest√£o Financeira

## üìã Sobre o Projeto

O **DimDim API** √© um sistema de gest√£o financeira desenvolvido em Java com Spring Boot para a disciplina de **Cloud Computing - FIAP**. O sistema permite gerenciar usu√°rios e suas transa√ß√µes financeiras, com persist√™ncia em Azure SQL Server e deploy na nuvem Azure.

Este projeto foi desenvolvido como parte do **2¬∫ Checkpoint** da disciplina, atendendo aos requisitos de aplica√ß√£o Web em nuvem com banco de dados PaaS.

## üèóÔ∏è Arquitetura

- **Backend**: Java 21 + Spring Boot 3.5.6
- **Banco de Dados**: Azure SQL Database (PaaS)
- **ORM**: JPA/Hibernate 6.6.29
- **Deploy**: Azure App Service
- **Monitoramento**: Application Insights
- **API**: REST com opera√ß√µes CRUD completas
- **Build Tool**: Gradle
- **Container**: Tomcat Embedded

## üéØ Objetivos do Projeto

- ‚úÖ Aplica√ß√£o Web em Java deployada na Azure
- ‚úÖ Banco de dados PaaS (Azure SQL Database)
- ‚úÖ Relacionamento Master-Detail (usuarios ‚Üî transacoes)
- ‚úÖ Monitoramento com Application Insights
- ‚úÖ Deploy automatizado via GitHub Actions ou Azure CLI
- ‚úÖ API REST completa com opera√ß√µes CRUD

## üìä Estrutura do Banco de Dados

### Tabelas

#### 1. **usuarios** (Tabela Master)

- `id`: Chave prim√°ria
- `nome`: Nome do usu√°rio
- `email`: Email √∫nico
- `cpf`: CPF √∫nico
- `telefone`: Telefone de contato
- `endereco`: Endere√ßo completo
- `saldo`: Saldo atual da conta
- `ativo`: Status da conta
- `data_criacao`: Data de cria√ß√£o
- `data_atualizacao`: Data da √∫ltima atualiza√ß√£o

#### 2. **transacoes** (Tabela Detail)

- `id`: Chave prim√°ria
- `valor`: Valor da transa√ß√£o
- `tipo`: Tipo da transa√ß√£o (DEPOSITO, SAQUE, TRANSFERENCIA_ENVIADA, etc.)
- `descricao`: Descri√ß√£o da transa√ß√£o
- `usuario_id`: Chave estrangeira para usuarios
- `data_transacao`: Data da transa√ß√£o
- `data_criacao`: Data de cria√ß√£o
- `data_atualizacao`: Data da √∫ltima atualiza√ß√£o

### Relacionamento

- **usuarios (1) -----> (N) transacoes**
- Relacionamento One-to-Many
- FK: `transacoes.usuario_id` -> `usuarios.id`

## üöÄ Como Executar Localmente

### Pr√©-requisitos

- Java 21+
- Maven ou Gradle
- Azure SQL Server (ou SQL Server local)

### 1. Clone o reposit√≥rio

```bash
git clone <url-do-repositorio>
cd API-Java
```

### 2. Configure o banco de dados

Edite o arquivo `src/main/resources/application.properties`:

```properties
# Para Azure SQL Server
spring.datasource.url=jdbc:sqlserver://seu-servidor.database.windows.net:1433;database=dimdim_db;encrypt=true;trustServerCertificate=false;hostNameInCertificate=*.database.windows.net;loginTimeout=30;
spring.datasource.username=seu-usuario
spring.datasource.password=sua-senha

# Para SQL Server local
spring.datasource.url=jdbc:sqlserver://localhost:1433;database=dimdim_db;encrypt=false;
spring.datasource.username=sa
spring.datasource.password=sua-senha
```

### 3. Execute o DDL

Execute o script SQL localizado em `database/ddl_tabelas.sql` no seu banco de dados.

### 4. Execute a aplica√ß√£o

```bash
./gradlew bootRun
```

A aplica√ß√£o estar√° dispon√≠vel em: `http://localhost:8080`

## üåê Deploy no Azure

### üìã Pr√©-requisitos

- Conta Azure ativa
- Azure CLI instalado e configurado
- Java 21 instalado
- Git configurado

### üöÄ Op√ß√£o 1: Deploy Automatizado via Azure CLI

#### 1. Criar Recursos na Azure

Execute o script para criar todos os recursos necess√°rios:

```bash
# Clone o reposit√≥rio
git clone https://github.com/seu-usuario/API-Java.git
cd API-Java

# Execute o script de cria√ß√£o de recursos
./scripts/create-azure-resources.sh
```

Este script criar√°:

- ‚úÖ Resource Group: `rg-dimdim-api`
- ‚úÖ App Service Plan: `asp-dimdim-api`
- ‚úÖ Web App: `dimdim-api-webapp`
- ‚úÖ SQL Server: `dimdim-sql-server`
- ‚úÖ SQL Database: `dimdim-database`
- ‚úÖ Application Insights: `appi-dimdim-api`

#### 2. Configurar Vari√°veis de Ambiente

```bash
# Execute o script de configura√ß√£o
./scripts/configure-environment.sh
```

#### 3. Deploy da Aplica√ß√£o

```bash
# Build e deploy
./scripts/deploy-app.sh
```

### üéØ Op√ß√£o 2: Deploy via IDE (VSCode/IntelliJ/Eclipse)

#### Pr√©-requisitos

- Plugin Azure instalado no IDE
- Azure CLI configurado
- Conta Azure ativa

#### Passos

1. **Instalar Plugin Azure**:

   - VSCode: Azure App Service extension
   - IntelliJ: Azure Toolkit for IntelliJ
   - Eclipse: Azure Toolkit for Eclipse

2. **Fazer Login na Azure**:

   ```bash
   az login
   ```

3. **Deploy via Plugin**:
   - Clique com bot√£o direito no projeto
   - Selecione "Deploy to Azure"
   - Configure as op√ß√µes de deploy
   - Execute o deploy

### üîÑ Op√ß√£o 3: Deploy via GitHub Actions (CI/CD)

#### Configurar GitHub Actions

1. **Crie o arquivo `.github/workflows/deploy.yml`**:

```yaml
name: Deploy DimDim API to Azure

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  AZURE_WEBAPP_NAME: dimdim-api-webapp
  AZURE_WEBAPP_PACKAGE_PATH: build/libs/*.jar
  JAVA_VERSION: "21"

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up JDK ${{ env.JAVA_VERSION }}
        uses: actions/setup-java@v3
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: "temurin"

      - name: Cache Gradle packages
        uses: actions/cache@v3
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle-

      - name: Build with Gradle
        run: ./gradlew build --no-daemon

      - name: Run tests
        run: ./gradlew test --no-daemon

      - name: Deploy to Azure Web App
        uses: azure/webapps-deploy@v2
        with:
          app-name: ${{ env.AZURE_WEBAPP_NAME }}
          publish-profile: ${{ secrets.AZURE_WEBAPP_PUBLISH_PROFILE }}
          package: ${{ env.AZURE_WEBAPP_PACKAGE_PATH }}
```

2. **Configure os Secrets no GitHub**:
   - V√° em Settings > Secrets and variables > Actions
   - Adicione: `AZURE_WEBAPP_PUBLISH_PROFILE`

### üîß Configura√ß√£o Manual (Alternativa)

Se preferir configurar manualmente:

#### 1. Criar Resource Group

```bash
az group create --name rg-dimdim-api --location "Brazil South"
```

#### 2. Criar App Service Plan

```bash
az appservice plan create \
  --name asp-dimdim-api \
  --resource-group rg-dimdim-api \
  --sku B1 \
  --is-linux
```

#### 3. Criar Web App

```bash
az webapp create \
  --name dimdim-api-webapp \
  --resource-group rg-dimdim-api \
  --plan asp-dimdim-api \
  --runtime "JAVA|21-java21"
```

#### 4. Criar SQL Server

```bash
az sql server create \
  --name dimdim-sql-server \
  --resource-group rg-dimdim-api \
  --location "Brazil South" \
  --admin-user dimdimadmin \
  --admin-password "SuaSenhaSegura123!"
```

#### 5. Criar SQL Database

```bash
az sql db create \
  --name dimdim-database \
  --resource-group rg-dimdim-api \
  --server dimdim-sql-server \
  --service-objective S0
```

#### 6. Configurar Firewall do SQL

```bash
az sql server firewall-rule create \
  --resource-group rg-dimdim-api \
  --server dimdim-sql-server \
  --name AllowAzureServices \
  --start-ip-address 0.0.0.0 \
  --end-ip-address 0.0.0.0
```

#### 7. Criar Application Insights

```bash
az monitor app-insights component create \
  --app appi-dimdim-api \
  --location "Brazil South" \
  --resource-group rg-dimdim-api
```

## üìö API Endpoints

### Usu√°rios

#### GET /api/usuarios

Lista todos os usu√°rios

```json
[
  {
    "id": 1,
    "nome": "Jo√£o Silva",
    "email": "joao@email.com",
    "cpf": "12345678901",
    "telefone": "(11) 99999-9999",
    "endereco": "Rua das Flores, 123",
    "saldo": 1000.0,
    "ativo": true,
    "dataCriacao": "2024-01-01T10:00:00",
    "dataAtualizacao": "2024-01-01T10:00:00"
  }
]
```

#### POST /api/usuarios

Cria novo usu√°rio

```json
{
  "nome": "Maria Santos",
  "email": "maria@email.com",
  "cpf": "98765432109",
  "telefone": "(11) 88888-8888",
  "endereco": "Av. Paulista, 456"
}
```

#### PUT /api/usuarios/{id}

Atualiza usu√°rio existente

#### DELETE /api/usuarios/{id}

Desativa usu√°rio (soft delete)

### Transa√ß√µes

#### GET /api/transacoes

Lista todas as transa√ß√µes

#### POST /api/transacoes

Cria nova transa√ß√£o

```json
{
  "valor": 500.0,
  "tipo": "DEPOSITO",
  "descricao": "Dep√≥sito inicial",
  "usuarioId": 1
}
```

#### PUT /api/transacoes/{id}

Atualiza transa√ß√£o existente

#### DELETE /api/transacoes/{id}

Remove transa√ß√£o

### Tipos de Transa√ß√£o

- `DEPOSITO`: Adiciona valor ao saldo
- `SAQUE`: Remove valor do saldo
- `TRANSFERENCIA_ENVIADA`: Remove valor do saldo
- `TRANSFERENCIA_RECEBIDA`: Adiciona valor ao saldo
- `PAGAMENTO`: Remove valor do saldo
- `RECEBIMENTO`: Adiciona valor ao saldo

## üîç Monitoramento com Application Insights

### Configura√ß√£o

1. Crie um recurso Application Insights no Azure
2. Copie a Instrumentation Key
3. Configure a vari√°vel de ambiente:
   ```
   APPINSIGHTS_INSTRUMENTATIONKEY=sua-chave-aqui
   ```

### M√©tricas Dispon√≠veis

- Requests por minuto
- Tempo de resposta
- Taxa de erro
- Depend√™ncias (banco de dados)
- Exce√ß√µes
- Logs customizados

### Acesso aos Dados

- Portal Azure > Application Insights > Live Metrics
- Logs Analytics para consultas avan√ßadas

## üß™ Testes da API

### Usando Postman/Insomnia

#### 1. Criar Usu√°rio

```http
POST http://localhost:8080/api/usuarios
Content-Type: application/json

{
  "nome": "Teste Usuario",
  "email": "teste@email.com",
  "cpf": "11122233344",
  "telefone": "(11) 77777-7777",
  "endereco": "Rua Teste, 123"
}
```

#### 2. Criar Transa√ß√£o

```http
POST http://localhost:8080/api/transacoes
Content-Type: application/json

{
  "valor": 1000.00,
  "tipo": "DEPOSITO",
  "descricao": "Dep√≥sito inicial",
  "usuarioId": 1
}
```

#### 3. Consultar Usu√°rio

```http
GET http://localhost:8080/api/usuarios/1
```

#### 4. Consultar Transa√ß√µes do Usu√°rio

```http
GET http://localhost:8080/api/transacoes/usuario/1
```

### Usando curl

```bash
# Criar usu√°rio
curl -X POST http://localhost:8080/api/usuarios \
  -H "Content-Type: application/json" \
  -d '{
    "nome": "Jo√£o Silva",
    "email": "joao@email.com",
    "cpf": "12345678901"
  }'

# Criar transa√ß√£o
curl -X POST http://localhost:8080/api/transacoes \
  -H "Content-Type: application/json" \
  -d '{
    "valor": 500.00,
    "tipo": "DEPOSITO",
    "descricao": "Dep√≥sito inicial",
    "usuarioId": 1
  }'
```

## üîß Configura√ß√µes Avan√ßadas

### Vari√°veis de Ambiente para Produ√ß√£o

```bash
DB_SERVER=dimdim-server.database.windows.net
DB_PORT=1433
DB_NAME=dimdim_db
DB_USERNAME=dimdim_admin
DB_PASSWORD=SenhaSegura123!
APPINSIGHTS_INSTRUMENTATIONKEY=abc123-def456-ghi789
```

### Configura√ß√µes de Log

```properties
logging.level.br.com.fiap.API.Java=INFO
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=WARN
```

## üêõ Troubleshooting

### Problemas Comuns

#### 1. Erro de Conex√£o com Banco

- Verifique as credenciais no `application.properties`
- Confirme se o firewall do Azure permite conex√µes
- Teste a conectividade com telnet

#### 2. Erro de Deploy

- Verifique se todas as depend√™ncias est√£o no `build.gradle`
- Confirme se as vari√°veis de ambiente est√£o configuradas
- Verifique os logs do App Service no portal Azure

#### 3. Erro de Application Insights

- Confirme se a Instrumentation Key est√° correta
- Verifique se o recurso Application Insights est√° ativo
- Aguarde alguns minutos para os dados aparecerem

## üìÅ Estrutura do Projeto

```
API-Java/
‚îú‚îÄ‚îÄ src/main/java/br/com/fiap/API/Java/
‚îÇ   ‚îú‚îÄ‚îÄ entity/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Usuario.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Transacao.java
‚îÇ   ‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UsuarioRepository.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TransacaoRepository.java
‚îÇ   ‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UsuarioController.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TransacaoController.java
‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UsuarioDTO.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TransacaoDTO.java
‚îÇ   ‚îî‚îÄ‚îÄ ApiJavaApplication.java
‚îú‚îÄ‚îÄ src/main/resources/
‚îÇ   ‚îî‚îÄ‚îÄ application.properties
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ ddl_tabelas.sql
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ create-resources.sh
‚îÇ   ‚îî‚îÄ‚îÄ deploy-app.sh
‚îú‚îÄ‚îÄ build.gradle
‚îî‚îÄ‚îÄ README.md
```

## üë• Integrantes do Grupo

- **Nome**: [Eduardo Miguel Forato Monteiro] - RM: [RM55871]
- **Nome**: [Cicero Gabriel Oliveira Serafim] - RM: [RM556996]
- **Nome**: [Murillo Sant'Anna - RM557183] - RM: [RM557183]
- **Nome**: [Nome do Integrante 4] - RM: [RM]

**Disciplina**: Cloud Computing - FIAP  
**Projeto**: DimDim API - Sistema de Gest√£o Financeira  
**Semestre**: [2S25
